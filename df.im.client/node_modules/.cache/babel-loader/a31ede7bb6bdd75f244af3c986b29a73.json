{"ast":null,"code":"import React,{useEffect}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import{showMain,showSetting,showChat,togglerMain,resize,togglerSetting,togglerChat,showHelp,togglerHelp,getUsers}from\"./imStore\";import ImMin from\"./imMin\";import ImMain from\"./imMain\";import ImSetting from\"./imSetting\";import ImChat from\"./imChat\";import ImHelp from\"./imHelp\";import\"./im.css\";import{ThemeContext,Themes}from\"./imThemeContext\";import VideoInviteContainer from\"./VideoInviteContainer\";import{useSocket}from\"../contexts/imSocket\";// import { users } from \"./imConsts\";\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Im(props){var _useSocket=useSocket(),socket=_useSocket.socket;var isShowMain=useSelector(showMain);var isShowSetting=useSelector(showSetting);var isShowChat=useSelector(showChat);var isShowHelp=useSelector(showHelp);var dispatch=useDispatch();var reFrame=function reFrame(){return dispatch(resize());};var onKeyDown=function onKeyDown(evt){// enter : 发送消息\n// if (evt.key === \"Enter\") {\n// }\n// ctrl+alt+m : 切换最小化\nif(evt.ctrlKey&&evt.altKey&&evt.keyCode===77){dispatch(togglerMain());}// ctrl+alt+c : 切换chat对话框\nif(evt.ctrlKey&&evt.altKey&&evt.keyCode===67){dispatch(togglerChat());}// ctrl+alt+f : 切换全屏\n// if (evt.ctrlKey && evt.altKey && evt.keyCode === 70) {\n//   dispatch(togglerChat());\n// }\n// ctrl+alt+s : 切换设置\nif(evt.ctrlKey&&evt.altKey&&evt.keyCode===83){dispatch(togglerSetting());}// ctrl+alt+h : 切换帮助\nif(evt.ctrlKey&&evt.altKey&&evt.keyCode===72){dispatch(togglerHelp());}};useEffect(function(){if(!socket)return;dispatch(getUsers());var handleUserDisconnected=function handleUserDisconnected(event){var offLineUsers=event.detail;console.log(\"User disconnected:\",offLineUsers);// 重新获取用户列表\ndispatch(getUsers());};window.addEventListener(\"resize\",reFrame);window.addEventListener(\"keydown\",onKeyDown);window.addEventListener(\"user_disconnected\",handleUserDisconnected);// 清理函数\nreturn function(){window.removeEventListener(\"resize\",reFrame);window.removeEventListener(\"keydown\",onKeyDown);window.removeEventListener(\"user_disconnected\",handleUserDisconnected);};},[socket,dispatch]);return/*#__PURE__*/_jsxs(ThemeContext.Provider,{value:Themes.red,children:[/*#__PURE__*/_jsx(VideoInviteContainer,{}),isShowMain?/*#__PURE__*/_jsx(ImMain,{}):/*#__PURE__*/_jsx(ImMin,{}),isShowSetting?/*#__PURE__*/_jsx(ImSetting,{}):null,isShowChat?/*#__PURE__*/_jsx(ImChat,{}):null,isShowHelp?/*#__PURE__*/_jsx(ImHelp,{}):null]});}export default Im;","map":{"version":3,"names":["React","useEffect","useSelector","useDispatch","showMain","showSetting","showChat","togglerMain","resize","togglerSetting","togglerChat","showHelp","togglerHelp","getUsers","ImMin","ImMain","ImSetting","ImChat","ImHelp","ThemeContext","Themes","VideoInviteContainer","useSocket","Im","props","socket","isShowMain","isShowSetting","isShowChat","isShowHelp","dispatch","reFrame","onKeyDown","evt","ctrlKey","altKey","keyCode","handleUserDisconnected","event","offLineUsers","detail","console","log","window","addEventListener","removeEventListener","red"],"sources":["/Users/feng/Work/Project/df/df.im/df.im.client/src/im/im.js"],"sourcesContent":["import React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n  showMain,\n  showSetting,\n  showChat,\n  togglerMain,\n  resize,\n  togglerSetting,\n  togglerChat,\n  showHelp,\n  togglerHelp,\n  getUsers,\n} from \"./imStore\";\nimport ImMin from \"./imMin\";\nimport ImMain from \"./imMain\";\nimport ImSetting from \"./imSetting\";\nimport ImChat from \"./imChat\";\nimport ImHelp from \"./imHelp\";\nimport \"./im.css\";\nimport { ThemeContext, Themes } from \"./imThemeContext\";\nimport VideoInviteContainer from \"./VideoInviteContainer\";\nimport { useSocket } from \"../contexts/imSocket\";\n// import { users } from \"./imConsts\";\n\nfunction Im(props) {\n  const { socket } = useSocket();\n\n  const isShowMain = useSelector(showMain);\n  const isShowSetting = useSelector(showSetting);\n  const isShowChat = useSelector(showChat);\n  const isShowHelp = useSelector(showHelp);\n\n  const dispatch = useDispatch();\n  const reFrame = () => dispatch(resize());\n\n  const onKeyDown = (evt) => {\n    // enter : 发送消息\n    // if (evt.key === \"Enter\") {\n    // }\n    // ctrl+alt+m : 切换最小化\n    if (evt.ctrlKey && evt.altKey && evt.keyCode === 77) {\n      dispatch(togglerMain());\n    }\n\n    // ctrl+alt+c : 切换chat对话框\n    if (evt.ctrlKey && evt.altKey && evt.keyCode === 67) {\n      dispatch(togglerChat());\n    }\n\n    // ctrl+alt+f : 切换全屏\n    // if (evt.ctrlKey && evt.altKey && evt.keyCode === 70) {\n    //   dispatch(togglerChat());\n    // }\n\n    // ctrl+alt+s : 切换设置\n    if (evt.ctrlKey && evt.altKey && evt.keyCode === 83) {\n      dispatch(togglerSetting());\n    }\n\n    // ctrl+alt+h : 切换帮助\n    if (evt.ctrlKey && evt.altKey && evt.keyCode === 72) {\n      dispatch(togglerHelp());\n    }\n  };\n\n  useEffect(() => {\n    if (!socket) return;\n    dispatch(getUsers());\n\n    const handleUserDisconnected = (event) => {\n      const offLineUsers = event.detail;\n      console.log(\"User disconnected:\", offLineUsers);\n      // 重新获取用户列表\n      dispatch(getUsers());\n    };\n\n    window.addEventListener(\"resize\", reFrame);\n    window.addEventListener(\"keydown\", onKeyDown);\n    window.addEventListener(\"user_disconnected\", handleUserDisconnected);\n\n    // 清理函数\n    return () => {\n      window.removeEventListener(\"resize\", reFrame);\n      window.removeEventListener(\"keydown\", onKeyDown);\n      window.removeEventListener(\"user_disconnected\", handleUserDisconnected);\n    };\n  }, [socket, dispatch]);\n\n  return (\n    <ThemeContext.Provider value={Themes.red}>\n      <VideoInviteContainer />\n      {isShowMain ? <ImMain /> : <ImMin />}\n      {isShowSetting ? <ImSetting /> : null}\n      {isShowChat ? <ImChat /> : null}\n      {isShowHelp ? <ImHelp /> : null}\n    </ThemeContext.Provider>\n  );\n}\n\nexport default Im;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}