{"ast":null,"code":"import _toConsumableArray from\"/Users/feng/Work/Project/df/df.im/df.im.client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"/Users/feng/Work/Project/df/df.im/df.im.client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/feng/Work/Project/df/df.im/df.im.client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/feng/Work/Project/df/df.im/df.im.client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useCallback,useEffect,useRef}from\"react\";import{FullScreen,useFullScreenHandle}from\"react-full-screen\";import{useSelector,useDispatch}from\"react-redux\";import{useSocket}from\"../contexts/imSocket\";import{addUnreadMessage}from\"./imStore\";import{togglerChat,clearUnreadMessages}from\"./imStore\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{faXmark,faCompress,faPhone,faPhoneSlash,faVideo,faSmile,faFile,faScissors,faMicrophone,faArrowPointer,faCamera,faEye,faFilm,faQrcode,faRecordVinyl,faMoneyBillTransfer,faPaperPlane,faUser}from\"@fortawesome/free-solid-svg-icons\";import{ImDialog}from\"./imCore\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ImChat(props){// private state *************************************\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),full=_useState2[0],setFull=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),hideControl=_useState4[0],setHideControl=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),hideLocalVideo=_useState6[0],setHideLocalVideo=_useState6[1];var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),mode=_useState8[0],setMode=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),message=_useState10[0],setMessage=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),messages=_useState12[0],setMessages=_useState12[1];var messagesEndRef=useRef(null);var handle=useFullScreenHandle();var scrollToBottom=function scrollToBottom(){var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:\"smooth\"});};// public state *************************************\nvar dispatch=useDispatch();var _useSocket=useSocket(),socket=_useSocket.socket,connected=_useSocket.connected,sendMessage=_useSocket.sendMessage;var size=useSelector(function(rootState){return rootState.imReducer.size;});var currentChatUser=useSelector(function(rootState){return rootState.imReducer.currentChatUser;});var bounds={left:full?0:size.left,top:full?0:size.top,right:size.right-170,bottom:size.bottom-50};// let localVideoref = React.createRef();\n// let localStream = null;\nvar localVideoref=useRef(null);var localStreamref=useRef(null);var onChange=useCallback(function(state,handle){setFull(state);},[]);// component logic *************************************\nvar showControl=function showControl(){return hideControl?null:/*#__PURE__*/_jsxs(\"div\",{className:\"control-panel\",children:[/*#__PURE__*/_jsx(\"button\",{id:\"callBtn\",className:\"im-chat-control-btn\",onClick:function onClick(){return setMode(1);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faPhoneSlash})}),/*#__PURE__*/_jsx(\"button\",{id:\"muteBtn\",className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faMicrophone})}),/*#__PURE__*/_jsx(\"button\",{id:\"closeVideoBtn\",className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faVideo})}),/*#__PURE__*/_jsx(\"button\",{id:\"fullScreenBtn\",className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faArrowPointer})}),/*#__PURE__*/_jsx(\"button\",{id:\"switchCameraBtn\",className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCamera})}),/*#__PURE__*/_jsx(\"button\",{id:\"hideBtn\",className:\"im-chat-control-btn\",onClick:function onClick(){return setHideLocalVideo(!hideLocalVideo);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faEye})}),/*#__PURE__*/_jsx(\"button\",{id:\"screenBtn\",className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFilm})}),/*#__PURE__*/_jsx(\"button\",{id:\"qrBtn\",className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faQrcode})}),/*#__PURE__*/_jsx(\"button\",{id:\"boardBtn\",className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faMoneyBillTransfer})}),/*#__PURE__*/_jsx(\"button\",{id:\"recordBtn\",className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faRecordVinyl})})]});};var getMedia=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(constraints){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return navigator.mediaDevices.getUserMedia(constraints);case 3:localStreamref.current=_context.sent;localVideoref.current.srcObject=localStreamref.current;// localVideoref.current.muted = true;\nlocalVideoref.current.play();_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function getMedia(_x){return _ref.apply(this,arguments);};}();var stopMedia=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:try{// localVideoref.current.stop();\nif(localStreamref.current){localStreamref.current.getTracks().forEach(function(track){track.stop();});localStreamref.current=null;}}catch(err){console.log(err);}case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function stopMedia(){return _ref2.apply(this,arguments);};}();useEffect(function(){if(mode===1){stopMedia();}else{getMedia({video:true,audio:true});}},[mode]);useEffect(function(){if(socket){socket.on(\"message\",function(msg){var _msg$from,_msg$account;// 只显示当前聊天用户的消息\nif(currentChatUser&&(((_msg$from=msg.from)===null||_msg$from===void 0?void 0:_msg$from.id)===currentChatUser.uid||((_msg$account=msg.account)===null||_msg$account===void 0?void 0:_msg$account.id)===currentChatUser.uid)){setMessages(function(prev){return[].concat(_toConsumableArray(prev),[msg]);});scrollToBottom();}});socket.on(\"history_messages\",function(messages){console.log(\"Received history messages:\",messages);// 过滤消息，只显示与当前聊天用户相关的消息\nvar filteredMessages=messages.filter(function(msg){var _msg$from2,_msg$account2;return currentChatUser&&(((_msg$from2=msg.from)===null||_msg$from2===void 0?void 0:_msg$from2.id)===currentChatUser.uid||((_msg$account2=msg.account)===null||_msg$account2===void 0?void 0:_msg$account2.id)===currentChatUser.uid);});setMessages(filteredMessages);scrollToBottom();});}return function(){if(socket){socket.off(\"message\");socket.off(\"history_messages\");}};},[socket,currentChatUser]);// 当打开聊天窗口时，加载历史消息\nuseEffect(function(){if(socket&&currentChatUser){var urlParams=new URLSearchParams(window.location.search);var fromUid=parseInt(urlParams.get(\"uId\"));// 清除未读消息计数\ndispatch(clearUnreadMessages({uid:currentChatUser.uid}));// 请求历史消息\nsocket.emit(\"get_history\",{fromUid:fromUid,toUid:currentChatUser.uid});// 清空当前消息列表\nsetMessages([]);// 更新全局变量，用于未读消息计数判断\nwindow.currentChatUser=currentChatUser;}// 组件卸载时清除全局变量\nreturn function(){window.currentChatUser=null;};},[socket,currentChatUser,dispatch]);useEffect(function(){scrollToBottom();},[messages]);var showLocalVideo=function showLocalVideo(){return hideLocalVideo?null:/*#__PURE__*/_jsxs(ImDialog,{padding:\"0px\",axis:\"both\",style:{resize:\"both\",width:\"150px\",height:\"150px\",minWidth:\"100px\",minHeight:\"100px\"},point:{x:300,y:20},children:[/*#__PURE__*/_jsx(\"video\",{id:\"localVideo\",ref:localVideoref,autoPlay:true,muted:true,playsInline:true}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-close\",onClick:function onClick(){return setHideLocalVideo(!hideLocalVideo);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faXmark})})]});};var videoMode=function videoMode(){return/*#__PURE__*/_jsxs(\"div\",{className:\"im-frame\",children:[showLocalVideo(),/*#__PURE__*/_jsx(\"video\",{id:\"remoteVideo\",autoPlay:true,muted:true,playsInline:true,onClick:function onClick(){return setHideControl(!hideControl);}}),showControl()]});};var textMode=function textMode(){return/*#__PURE__*/_jsxs(\"div\",{className:\"im-frame\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"im-chat\",style:{flex:1,padding:\"10px\",overflow:\"auto\"},children:[messages.map(function(msg,index){var _msg$from3,_msg$from4;var currentUid=parseInt(new URLSearchParams(window.location.search).get(\"uId\"));var isMe=((_msg$from3=msg.from)===null||_msg$from3===void 0?void 0:_msg$from3.id)===currentUid;console.log(\"Message sender:\",(_msg$from4=msg.from)===null||_msg$from4===void 0?void 0:_msg$from4.id,\"Current user:\",currentUid,\"isMe:\",isMe);var time=new Date(msg.timestamp).toLocaleString();if(index===0||new Date(msg.timestamp).getDate()!==new Date(messages[index-1].timestamp).getDate()){return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"im-chat-time\",children:time}),/*#__PURE__*/_jsxs(\"div\",{className:isMe?\"me-chat-panel\":\"you-chat-panel\",children:[!isMe&&/*#__PURE__*/_jsx(\"button\",{className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faUser})}),/*#__PURE__*/_jsx(\"div\",{className:isMe?\"me-chat\":\"you-chat\",children:msg.content}),isMe&&/*#__PURE__*/_jsx(\"button\",{className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faUser})})]})]},index);}return/*#__PURE__*/_jsxs(\"div\",{className:isMe?\"me-chat-panel\":\"you-chat-panel\",children:[!isMe&&/*#__PURE__*/_jsx(\"button\",{className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faUser})}),/*#__PURE__*/_jsx(\"div\",{className:isMe?\"me-chat\":\"you-chat\",children:msg.content}),isMe&&/*#__PURE__*/_jsx(\"button\",{className:\"im-chat-control-btn\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faUser})})]},index);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"im-chat\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:\"5px\"},children:[/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",onClick:function onClick(){return dispatch(togglerChat(currentChatUser));},onTouchEnd:function onTouchEnd(){return dispatch(togglerChat(currentChatUser));},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faSmile})}),/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",onClick:function onClick(){return dispatch(togglerChat(currentChatUser));},onTouchEnd:function onTouchEnd(){return dispatch(togglerChat(currentChatUser));},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFile})}),/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",onClick:function onClick(){return dispatch(togglerChat(currentChatUser));},onTouchEnd:function onTouchEnd(){return dispatch(togglerChat(currentChatUser));},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faScissors})}),/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",onClick:function onClick(){return dispatch(togglerChat());},onTouchEnd:function onTouchEnd(){return dispatch(togglerChat());},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faPhone})}),/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",onClick:function onClick(){return setMode(2);},onTouchEnd:function onTouchEnd(){return setMode(2);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faVideo})}),/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",onClick:function onClick(){return setMode(2);},onTouchEnd:function onTouchEnd(){return setMode(2);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faPaperPlane})})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"textarea\",{className:\"im-input\",type:\"text\",placeholder:\"\\u5728\\u6B64\\u8F93\\u5165\\u6587\\u672C\\u6D88\\u606F\\uFF0C\\u6309\\u56DE\\u8F66\\u952E\\u53D1\\u9001\",value:message,onChange:function onChange(e){return setMessage(e.target.value);},onKeyPress:function onKeyPress(e){if(e.key===\"Enter\"&&!e.shiftKey){e.preventDefault();if(message.trim()){// 发送消息\nif(currentChatUser&&currentChatUser.uid){sendMessage(currentChatUser.uid,message.trim());}else{console.error(\"No valid chat user selected\");}setMessage(\"\");}}},required:true})})]})]});};return/*#__PURE__*/_jsx(FullScreen,{handle:handle,onChange:onChange,children:/*#__PURE__*/_jsx(ImDialog,{point:{x:full?0:bounds.left+230,y:full?0:bounds.top},bounds:bounds,title:/*#__PURE__*/_jsx(\"span\",{className:\"im-header-title\",children:(currentChatUser===null||currentChatUser===void 0?void 0:currentChatUser.name)||\"聊天\"}),buttons:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",onClick:function onClick(){if(!full){setFull(true);handle.enter();}else{setFull(false);handle.exit();}},onTouchEnd:handle.enter,children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCompress})}),/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",onClick:function onClick(){return dispatch(togglerChat(null));},onTouchEnd:function onTouchEnd(){return dispatch(togglerChat(null));},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faXmark})})]}),style:{width:full?\"100vw\":500,height:full?\"100vh\":500,resize:full?\"none\":\"both\",minWidth:400,minHeight:400},axis:full?\"none\":\"both\",cancel:\".im-frame\",children:mode===1?textMode():videoMode()})});}export default ImChat;","map":{"version":3,"names":["React","useState","useCallback","useEffect","useRef","FullScreen","useFullScreenHandle","useSelector","useDispatch","useSocket","addUnreadMessage","togglerChat","clearUnreadMessages","FontAwesomeIcon","faXmark","faCompress","faPhone","faPhoneSlash","faVideo","faSmile","faFile","faScissors","faMicrophone","faArrowPointer","faCamera","faEye","faFilm","faQrcode","faRecordVinyl","faMoneyBillTransfer","faPaperPlane","faUser","ImDialog","ImChat","props","full","setFull","hideControl","setHideControl","hideLocalVideo","setHideLocalVideo","mode","setMode","message","setMessage","messages","setMessages","messagesEndRef","handle","scrollToBottom","current","scrollIntoView","behavior","dispatch","socket","connected","sendMessage","size","rootState","imReducer","currentChatUser","bounds","left","top","right","bottom","localVideoref","localStreamref","onChange","state","showControl","getMedia","constraints","navigator","mediaDevices","getUserMedia","srcObject","play","console","log","stopMedia","getTracks","forEach","track","stop","err","video","audio","on","msg","from","id","uid","account","prev","filteredMessages","filter","off","urlParams","URLSearchParams","window","location","search","fromUid","parseInt","get","emit","toUid","showLocalVideo","resize","width","height","minWidth","minHeight","x","y","videoMode","textMode","flex","padding","overflow","map","index","currentUid","isMe","time","Date","timestamp","toLocaleString","getDate","content","e","target","value","key","shiftKey","preventDefault","trim","error","name","enter","exit"],"sources":["/Users/feng/Work/Project/df/df.im/df.im.client/src/im/imChat.js"],"sourcesContent":["import React, { useState, useCallback, useEffect, useRef } from \"react\";\nimport { FullScreen, useFullScreenHandle } from \"react-full-screen\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useSocket } from \"../contexts/imSocket\";\nimport { addUnreadMessage } from \"./imStore\";\nimport { togglerChat, clearUnreadMessages } from \"./imStore\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faXmark,\n  faCompress,\n  faPhone,\n  faPhoneSlash,\n  faVideo,\n  faSmile,\n  faFile,\n  faScissors,\n  faMicrophone,\n  faArrowPointer,\n  faCamera,\n  faEye,\n  faFilm,\n  faQrcode,\n  faRecordVinyl,\n  faMoneyBillTransfer,\n  faPaperPlane,\n  faUser,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { ImDialog } from \"./imCore\";\n\nfunction ImChat(props) {\n  // private state *************************************\n  const [full, setFull] = useState(false);\n  const [hideControl, setHideControl] = useState(false);\n  const [hideLocalVideo, setHideLocalVideo] = useState(false);\n  const [mode, setMode] = useState(1);\n  const [message, setMessage] = useState(\"\");\n  const [messages, setMessages] = useState([]);\n  const messagesEndRef = useRef(null);\n  const handle = useFullScreenHandle();\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  // public state *************************************\n  const dispatch = useDispatch();\n  const { socket, connected, sendMessage } = useSocket();\n  const size = useSelector((rootState) => rootState.imReducer.size);\n  const currentChatUser = useSelector(\n    (rootState) => rootState.imReducer.currentChatUser\n  );\n  let bounds = {\n    left: full ? 0 : size.left,\n    top: full ? 0 : size.top,\n    right: size.right - 170,\n    bottom: size.bottom - 50,\n  };\n\n  // let localVideoref = React.createRef();\n  // let localStream = null;\n\n  const localVideoref = useRef(null);\n  const localStreamref = useRef(null);\n\n  const onChange = useCallback((state, handle) => {\n    setFull(state);\n  }, []);\n\n  // component logic *************************************\n  const showControl = () => {\n    return hideControl ? null : (\n      <div className=\"control-panel\">\n        <button\n          id=\"callBtn\"\n          className=\"im-chat-control-btn\"\n          onClick={() => setMode(1)}\n        >\n          <FontAwesomeIcon icon={faPhoneSlash} />\n        </button>\n        <button id=\"muteBtn\" className=\"im-chat-control-btn\">\n          <FontAwesomeIcon icon={faMicrophone} />\n        </button>\n        <button id=\"closeVideoBtn\" className=\"im-chat-control-btn\">\n          <FontAwesomeIcon icon={faVideo} />\n        </button>\n        <button id=\"fullScreenBtn\" className=\"im-chat-control-btn\">\n          <FontAwesomeIcon icon={faArrowPointer} />\n        </button>\n        <button id=\"switchCameraBtn\" className=\"im-chat-control-btn\">\n          <FontAwesomeIcon icon={faCamera} />\n        </button>\n        <button\n          id=\"hideBtn\"\n          className=\"im-chat-control-btn\"\n          onClick={() => setHideLocalVideo(!hideLocalVideo)}\n        >\n          <FontAwesomeIcon icon={faEye} />\n        </button>\n        <button id=\"screenBtn\" className=\"im-chat-control-btn\">\n          <FontAwesomeIcon icon={faFilm} />\n        </button>\n        <button id=\"qrBtn\" className=\"im-chat-control-btn\">\n          <FontAwesomeIcon icon={faQrcode} />\n        </button>\n        <button id=\"boardBtn\" className=\"im-chat-control-btn\">\n          <FontAwesomeIcon icon={faMoneyBillTransfer} />\n        </button>\n        <button id=\"recordBtn\" className=\"im-chat-control-btn\">\n          <FontAwesomeIcon icon={faRecordVinyl} />\n        </button>\n      </div>\n    );\n  };\n\n  const getMedia = async (constraints) => {\n    try {\n      localStreamref.current = await navigator.mediaDevices.getUserMedia(\n        constraints\n      );\n      localVideoref.current.srcObject = localStreamref.current;\n      // localVideoref.current.muted = true;\n      localVideoref.current.play();\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const stopMedia = async () => {\n    try {\n      // localVideoref.current.stop();\n      if (localStreamref.current) {\n        localStreamref.current.getTracks().forEach((track) => {\n          track.stop();\n        });\n        localStreamref.current = null;\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  useEffect(() => {\n    if (mode === 1) {\n      stopMedia();\n    } else {\n      getMedia({ video: true, audio: true });\n    }\n  }, [mode]);\n\n  useEffect(() => {\n    if (socket) {\n      socket.on(\"message\", (msg) => {\n        // 只显示当前聊天用户的消息\n        if (\n          currentChatUser &&\n          (msg.from?.id === currentChatUser.uid ||\n            msg.account?.id === currentChatUser.uid)\n        ) {\n          setMessages((prev) => [...prev, msg]);\n          scrollToBottom();\n        }\n      });\n\n      socket.on(\"history_messages\", (messages) => {\n        console.log(\"Received history messages:\", messages);\n        // 过滤消息，只显示与当前聊天用户相关的消息\n        const filteredMessages = messages.filter(\n          (msg) =>\n            currentChatUser &&\n            (msg.from?.id === currentChatUser.uid ||\n              msg.account?.id === currentChatUser.uid)\n        );\n        setMessages(filteredMessages);\n        scrollToBottom();\n      });\n    }\n    return () => {\n      if (socket) {\n        socket.off(\"message\");\n        socket.off(\"history_messages\");\n      }\n    };\n  }, [socket, currentChatUser]);\n\n  // 当打开聊天窗口时，加载历史消息\n  useEffect(() => {\n    if (socket && currentChatUser) {\n      const urlParams = new URLSearchParams(window.location.search);\n      const fromUid = parseInt(urlParams.get(\"uId\"));\n\n      // 清除未读消息计数\n      dispatch(clearUnreadMessages({ uid: currentChatUser.uid }));\n\n      // 请求历史消息\n      socket.emit(\"get_history\", {\n        fromUid,\n        toUid: currentChatUser.uid,\n      });\n\n      // 清空当前消息列表\n      setMessages([]);\n\n      // 更新全局变量，用于未读消息计数判断\n      window.currentChatUser = currentChatUser;\n    }\n\n    // 组件卸载时清除全局变量\n    return () => {\n      window.currentChatUser = null;\n    };\n  }, [socket, currentChatUser, dispatch]);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const showLocalVideo = () => {\n    return hideLocalVideo ? null : (\n      <ImDialog\n        padding={\"0px\"}\n        axis={\"both\"}\n        style={{\n          resize: \"both\",\n          width: \"150px\",\n          height: \"150px\",\n          minWidth: \"100px\",\n          minHeight: \"100px\",\n        }}\n        point={{\n          x: 300,\n          y: 20,\n        }}\n      >\n        <video\n          id=\"localVideo\"\n          ref={localVideoref}\n          autoPlay\n          muted\n          playsInline\n        ></video>\n        <button\n          className=\"btn-close\"\n          onClick={() => setHideLocalVideo(!hideLocalVideo)}\n        >\n          <FontAwesomeIcon icon={faXmark} />\n        </button>\n      </ImDialog>\n    );\n  };\n\n  const videoMode = () => {\n    return (\n      <div className=\"im-frame\">\n        {showLocalVideo()}\n        <video\n          id=\"remoteVideo\"\n          autoPlay\n          muted\n          playsInline\n          onClick={() => setHideControl(!hideControl)}\n        ></video>\n        {showControl()}\n      </div>\n    );\n  };\n\n  const textMode = () => {\n    return (\n      <div className=\"im-frame\">\n        <div\n          className=\"im-chat\"\n          style={{ flex: 1, padding: \"10px\", overflow: \"auto\" }}\n        >\n          {messages.map((msg, index) => {\n            const currentUid = parseInt(\n              new URLSearchParams(window.location.search).get(\"uId\")\n            );\n            const isMe = msg.from?.id === currentUid;\n            console.log(\n              \"Message sender:\",\n              msg.from?.id,\n              \"Current user:\",\n              currentUid,\n              \"isMe:\",\n              isMe\n            );\n            const time = new Date(msg.timestamp).toLocaleString();\n\n            if (\n              index === 0 ||\n              new Date(msg.timestamp).getDate() !==\n                new Date(messages[index - 1].timestamp).getDate()\n            ) {\n              return (\n                <React.Fragment key={index}>\n                  <div className=\"im-chat-time\">{time}</div>\n                  <div className={isMe ? \"me-chat-panel\" : \"you-chat-panel\"}>\n                    {!isMe && (\n                      <button className=\"im-chat-control-btn\">\n                        <FontAwesomeIcon icon={faUser} />\n                      </button>\n                    )}\n                    <div className={isMe ? \"me-chat\" : \"you-chat\"}>\n                      {msg.content}\n                    </div>\n                    {isMe && (\n                      <button className=\"im-chat-control-btn\">\n                        <FontAwesomeIcon icon={faUser} />\n                      </button>\n                    )}\n                  </div>\n                </React.Fragment>\n              );\n            }\n\n            return (\n              <div\n                key={index}\n                className={isMe ? \"me-chat-panel\" : \"you-chat-panel\"}\n              >\n                {!isMe && (\n                  <button className=\"im-chat-control-btn\">\n                    <FontAwesomeIcon icon={faUser} />\n                  </button>\n                )}\n                <div className={isMe ? \"me-chat\" : \"you-chat\"}>\n                  {msg.content}\n                </div>\n                {isMe && (\n                  <button className=\"im-chat-control-btn\">\n                    <FontAwesomeIcon icon={faUser} />\n                  </button>\n                )}\n              </div>\n            );\n          })}\n          <div ref={messagesEndRef} />\n        </div>\n        <div className=\"im-chat\">\n          <div style={{ padding: \"5px\" }}>\n            <button\n              className=\"im-header-button\"\n              onClick={() => dispatch(togglerChat(currentChatUser))}\n              onTouchEnd={() => dispatch(togglerChat(currentChatUser))}\n            >\n              <FontAwesomeIcon icon={faSmile} />\n            </button>\n            <button\n              className=\"im-header-button\"\n              onClick={() => dispatch(togglerChat(currentChatUser))}\n              onTouchEnd={() => dispatch(togglerChat(currentChatUser))}\n            >\n              <FontAwesomeIcon icon={faFile} />\n            </button>\n            <button\n              className=\"im-header-button\"\n              onClick={() => dispatch(togglerChat(currentChatUser))}\n              onTouchEnd={() => dispatch(togglerChat(currentChatUser))}\n            >\n              <FontAwesomeIcon icon={faScissors} />\n            </button>\n            <button\n              className=\"im-header-button\"\n              onClick={() => dispatch(togglerChat())}\n              onTouchEnd={() => dispatch(togglerChat())}\n            >\n              <FontAwesomeIcon icon={faPhone} />\n            </button>\n            <button\n              className=\"im-header-button\"\n              onClick={() => setMode(2)}\n              onTouchEnd={() => setMode(2)}\n            >\n              <FontAwesomeIcon icon={faVideo} />\n            </button>\n            <button\n              className=\"im-header-button\"\n              onClick={() => setMode(2)}\n              onTouchEnd={() => setMode(2)}\n            >\n              <FontAwesomeIcon icon={faPaperPlane} />\n            </button>\n          </div>\n          <div>\n            <textarea\n              className=\"im-input\"\n              type=\"text\"\n              placeholder=\"在此输入文本消息，按回车键发送\"\n              value={message}\n              onChange={(e) => setMessage(e.target.value)}\n              onKeyPress={(e) => {\n                if (e.key === \"Enter\" && !e.shiftKey) {\n                  e.preventDefault();\n                  if (message.trim()) {\n                    // 发送消息\n                    if (currentChatUser && currentChatUser.uid) {\n                      sendMessage(currentChatUser.uid, message.trim());\n                    } else {\n                      console.error(\"No valid chat user selected\");\n                    }\n                    setMessage(\"\");\n                  }\n                }\n              }}\n              required\n            />\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <FullScreen handle={handle} onChange={onChange}>\n      <ImDialog\n        point={{ x: full ? 0 : bounds.left + 230, y: full ? 0 : bounds.top }}\n        bounds={bounds}\n        title={\n          <span className=\"im-header-title\">\n            {currentChatUser?.name || \"聊天\"}\n          </span>\n        }\n        buttons={\n          <div>\n            <button\n              className=\"im-header-button\"\n              onClick={() => {\n                if (!full) {\n                  setFull(true);\n                  handle.enter();\n                } else {\n                  setFull(false);\n                  handle.exit();\n                }\n              }}\n              onTouchEnd={handle.enter}\n            >\n              <FontAwesomeIcon icon={faCompress} />\n            </button>\n            <button\n              className=\"im-header-button\"\n              onClick={() => dispatch(togglerChat(null))}\n              onTouchEnd={() => dispatch(togglerChat(null))}\n            >\n              <FontAwesomeIcon icon={faXmark} />\n            </button>\n          </div>\n        }\n        style={{\n          width: full ? \"100vw\" : 500,\n          height: full ? \"100vh\" : 500,\n          resize: full ? \"none\" : \"both\",\n          minWidth: 400,\n          minHeight: 400,\n        }}\n        axis={full ? \"none\" : \"both\"}\n        cancel={\".im-frame\"}\n      >\n        {mode === 1 ? textMode() : videoMode()}\n      </ImDialog>\n    </FullScreen>\n  );\n}\n\nexport default ImChat;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}