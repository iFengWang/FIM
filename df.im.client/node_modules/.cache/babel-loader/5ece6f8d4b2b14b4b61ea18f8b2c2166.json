{"ast":null,"code":"import React,{useEffect}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import{showMain,showSetting,showChat,togglerMain,resize,togglerSetting,togglerChat,showHelp,togglerHelp,getUsers}from\"./imStore\";import ImMin from\"./imMin\";import ImMain from\"./imMain\";import ImSetting from\"./imSetting\";import ImChat from\"./imChat\";import ImHelp from\"./imHelp\";import\"./im.css\";import{ThemeContext,Themes}from\"./imThemeContext\";import{useSocket}from\"../contexts/imSocket\";// import { users } from \"./imConsts\";\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Im(props){var _useSocket=useSocket(),socket=_useSocket.socket;var isShowMain=useSelector(showMain);var isShowSetting=useSelector(showSetting);var isShowChat=useSelector(showChat);var isShowHelp=useSelector(showHelp);var dispatch=useDispatch();var reFrame=function reFrame(){return dispatch(resize());};var onKeyDown=function onKeyDown(evt){// enter : 发送消息\n// if (evt.key === \"Enter\") {\n// }\n// ctrl+alt+m : 切换最小化\nif(evt.ctrlKey&&evt.altKey&&evt.keyCode===77){dispatch(togglerMain());}// ctrl+alt+c : 切换chat对话框\nif(evt.ctrlKey&&evt.altKey&&evt.keyCode===67){dispatch(togglerChat());}// ctrl+alt+f : 切换全屏\n// if (evt.ctrlKey && evt.altKey && evt.keyCode === 70) {\n//   dispatch(togglerChat());\n// }\n// ctrl+alt+s : 切换设置\nif(evt.ctrlKey&&evt.altKey&&evt.keyCode===83){dispatch(togglerSetting());}// ctrl+alt+h : 切换帮助\nif(evt.ctrlKey&&evt.altKey&&evt.keyCode===72){dispatch(togglerHelp());}};useEffect(function(){if(!socket)return;dispatch(getUsers());var onConnected=function onConnected(){console.log(\"connected............\");};// 发送心跳包\nvar pingInterval=setInterval(function(){if(socket.connected){socket.emit(\"pp\");}},25000);// 接收心跳包\nsocket.on(\"pp\",function(res){console.log(\"pingpong......It work!\");});socket.on(\"connected\",onConnected);// 监听用户断开连接事件\nsocket.on(\"user_disconnected\",function(offLineUsers){console.log(\"User disconnected:\",offLineUsers);// 重新获取用户列表\ndispatch(getUsers());});window.addEventListener(\"resize\",reFrame);window.addEventListener(\"keydown\",onKeyDown);// 清理函数\nreturn function(){clearInterval(pingInterval);window.removeEventListener(\"resize\",reFrame);window.removeEventListener(\"keydown\",onKeyDown);socket.off(\"connected\",onConnected);socket.off(\"pp\");socket.off(\"user_disconnected\");};},[socket,dispatch]);return/*#__PURE__*/_jsxs(ThemeContext.Provider,{value:Themes.red,children:[isShowMain?/*#__PURE__*/_jsx(ImMain,{}):/*#__PURE__*/_jsx(ImMin,{}),isShowSetting?/*#__PURE__*/_jsx(ImSetting,{}):null,isShowChat?/*#__PURE__*/_jsx(ImChat,{}):null,isShowHelp?/*#__PURE__*/_jsx(ImHelp,{}):null]});}export default Im;","map":{"version":3,"names":["React","useEffect","useSelector","useDispatch","showMain","showSetting","showChat","togglerMain","resize","togglerSetting","togglerChat","showHelp","togglerHelp","getUsers","ImMin","ImMain","ImSetting","ImChat","ImHelp","ThemeContext","Themes","useSocket","Im","props","socket","isShowMain","isShowSetting","isShowChat","isShowHelp","dispatch","reFrame","onKeyDown","evt","ctrlKey","altKey","keyCode","onConnected","console","log","pingInterval","setInterval","connected","emit","on","res","offLineUsers","window","addEventListener","clearInterval","removeEventListener","off","red"],"sources":["/Users/feng/Work/Project/df/df.im/df.im.client/src/im/im.js"],"sourcesContent":["import React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n  showMain,\n  showSetting,\n  showChat,\n  togglerMain,\n  resize,\n  togglerSetting,\n  togglerChat,\n  showHelp,\n  togglerHelp,\n  getUsers,\n} from \"./imStore\";\nimport ImMin from \"./imMin\";\nimport ImMain from \"./imMain\";\nimport ImSetting from \"./imSetting\";\nimport ImChat from \"./imChat\";\nimport ImHelp from \"./imHelp\";\nimport \"./im.css\";\nimport { ThemeContext, Themes } from \"./imThemeContext\";\nimport { useSocket } from \"../contexts/imSocket\";\n// import { users } from \"./imConsts\";\n\nfunction Im(props) {\n  const { socket } = useSocket();\n\n  const isShowMain = useSelector(showMain);\n  const isShowSetting = useSelector(showSetting);\n  const isShowChat = useSelector(showChat);\n  const isShowHelp = useSelector(showHelp);\n\n  const dispatch = useDispatch();\n  const reFrame = () => dispatch(resize());\n\n  const onKeyDown = (evt) => {\n    // enter : 发送消息\n    // if (evt.key === \"Enter\") {\n    // }\n    // ctrl+alt+m : 切换最小化\n    if (evt.ctrlKey && evt.altKey && evt.keyCode === 77) {\n      dispatch(togglerMain());\n    }\n\n    // ctrl+alt+c : 切换chat对话框\n    if (evt.ctrlKey && evt.altKey && evt.keyCode === 67) {\n      dispatch(togglerChat());\n    }\n\n    // ctrl+alt+f : 切换全屏\n    // if (evt.ctrlKey && evt.altKey && evt.keyCode === 70) {\n    //   dispatch(togglerChat());\n    // }\n\n    // ctrl+alt+s : 切换设置\n    if (evt.ctrlKey && evt.altKey && evt.keyCode === 83) {\n      dispatch(togglerSetting());\n    }\n\n    // ctrl+alt+h : 切换帮助\n    if (evt.ctrlKey && evt.altKey && evt.keyCode === 72) {\n      dispatch(togglerHelp());\n    }\n  };\n\n  useEffect(() => {\n    if (!socket) return;\n    dispatch(getUsers());\n\n    const onConnected = () => {\n      console.log(\"connected............\");\n    };\n\n    // 发送心跳包\n    const pingInterval = setInterval(() => {\n      if (socket.connected) {\n        socket.emit(\"pp\");\n      }\n    }, 25000);\n\n    // 接收心跳包\n    socket.on(\"pp\", (res) => {\n      console.log(\"pingpong......It work!\");\n    });\n\n    socket.on(\"connected\", onConnected);\n\n    // 监听用户断开连接事件\n    socket.on(\"user_disconnected\", (offLineUsers) => {\n      console.log(\"User disconnected:\", offLineUsers);\n      // 重新获取用户列表\n      dispatch(getUsers());\n    });\n\n    window.addEventListener(\"resize\", reFrame);\n    window.addEventListener(\"keydown\", onKeyDown);\n\n    // 清理函数\n    return () => {\n      clearInterval(pingInterval);\n      window.removeEventListener(\"resize\", reFrame);\n      window.removeEventListener(\"keydown\", onKeyDown);\n      socket.off(\"connected\", onConnected);\n      socket.off(\"pp\");\n      socket.off(\"user_disconnected\");\n    };\n  }, [socket, dispatch]);\n\n  return (\n    <ThemeContext.Provider value={Themes.red}>\n      {isShowMain ? <ImMain /> : <ImMin />}\n      {isShowSetting ? <ImSetting /> : null}\n      {isShowChat ? <ImChat /> : null}\n      {isShowHelp ? <ImHelp /> : null}\n    </ThemeContext.Provider>\n  );\n}\n\nexport default Im;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}