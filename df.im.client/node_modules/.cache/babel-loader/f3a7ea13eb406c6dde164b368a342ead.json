{"ast":null,"code":"import React from\"react\";import{useSelector,useDispatch}from\"react-redux\";import{togglerMain,togglerSetting,togglerChat,togglerHelp,clearUnreadMessages}from\"./imStore\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{faMinus,faMagnifyingGlass,faGear,faCircleQuestion,faBuildingUser,faUser}from\"@fortawesome/free-solid-svg-icons\";import{ImDialog}from\"./imCore\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ImMain(){var dispatch=useDispatch();var size=useSelector(function(state){return state.imReducer.size;});var users=useSelector(function(state){return state.imReducer.users;});var onlineUsers=useSelector(function(state){return state.imReducer.onlineUsers;});var unreadMessages=useSelector(function(state){return state.imReducer.unreadMessages;});var bounds={left:size.left,top:size.top,right:size.right-170,bottom:size.bottom-50};var getMeUid=function getMeUid(){var urlParams=new URLSearchParams(window.location.search);var uid=urlParams.get(\"uId\");return parseInt(uid);};var togglerNode=function togglerNode(node){if(node.target.tagName===\"UL\")return;var isHide=node.currentTarget.children[1].style.display===\"none\";node.currentTarget.className=isHide?\"open department im-node-text\":\"close department im-node-text\";for(var i=1;i<node.currentTarget.children.length;i++){node.currentTarget.children[i].style.display=isHide?\"block\":\"none\";}};var traverseNode=function traverseNode(nodes){if(!Array.isArray(nodes)){console.error(\"Expected nodes to be an array, got:\",nodes);return[];}return nodes.map(function(node){return/*#__PURE__*/_jsxs(\"li\",{className:node.type===\"C\"?\"open department im-node-text\":onlineUsers[node.uid]?\"user user-online im-node-text\":\"user user-offline im-node-text\",onClick:function onClick(e){e.stopPropagation();if(node.type===\"U\"){var urlParams=new URLSearchParams(window.location.search);var currentUid=parseInt(urlParams.get(\"uId\"));if(node.uid===currentUid){alert(\"不能给自己发消息！\");return;}dispatch(togglerChat({name:node.name,uid:node.uid}));dispatch(clearUnreadMessages({uid:node.uid}));}else{togglerNode(e);}},onTouchEnd:function onTouchEnd(e){if(node.type===\"U\"){var urlParams=new URLSearchParams(window.location.search);var currentUid=parseInt(urlParams.get(\"uId\"));if(node.uid===currentUid){alert(\"不能给自己发消息！\");return;}dispatch(togglerChat({name:node.name,uid:node.uid}));dispatch(clearUnreadMessages({uid:node.uid}));}},children:[node.type===\"C\"?/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faBuildingUser,className:\"avtar\"}):/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faUser,className:\"avtar\"}),node.name,node.uid===getMeUid()?\" [Me]\":null,unreadMessages[node.uid]>0&&/*#__PURE__*/_jsx(\"span\",{className:\"unread-count\",children:unreadMessages[node.uid]}),node.child?/*#__PURE__*/_jsx(\"ul\",{children:traverseNode(node.child)}):null]},node.uid+node.type+Math.random());});};return/*#__PURE__*/_jsx(ImDialog,{point:{x:bounds.left,y:bounds.top},bounds:bounds,title:/*#__PURE__*/_jsx(\"span\",{className:\"im-header-title\",children:\"IM\"}),buttons:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",onClick:function onClick(){return dispatch(togglerHelp());},onTouchEnd:function onTouchEnd(){return dispatch(togglerHelp());},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCircleQuestion})}),/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",onClick:function onClick(){return dispatch(togglerSetting());},onTouchEnd:function onTouchEnd(){return dispatch(togglerSetting());},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faGear})}),/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",onClick:function onClick(){return dispatch(togglerMain());},onTouchEnd:function onTouchEnd(){return dispatch(togglerMain());},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faMinus})})]}),cancel:\".im-header-button, .im-search\",style:{height:500,width:205,resize:\"both\",minWidth:205,minHeight:300,maxWidth:250},children:/*#__PURE__*/_jsxs(\"div\",{className:\"im-frame\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"im-search\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"im-input\",type:\"text\",placeholder:\"\\u8BF7\\u8F93\\u5165\\u5BF9\\u65B9\\u7684\\u6635\\u79F0\",required:true}),/*#__PURE__*/_jsx(\"button\",{className:\"im-header-button\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faMagnifyingGlass})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"im-main-list\",children:/*#__PURE__*/_jsx(\"ul\",{className:\"domtree\",children:traverseNode(users)})})]})});}export default ImMain;","map":{"version":3,"names":["React","useSelector","useDispatch","togglerMain","togglerSetting","togglerChat","togglerHelp","clearUnreadMessages","FontAwesomeIcon","faMinus","faMagnifyingGlass","faGear","faCircleQuestion","faBuildingUser","faUser","ImDialog","ImMain","dispatch","size","state","imReducer","users","onlineUsers","unreadMessages","bounds","left","top","right","bottom","getMeUid","urlParams","URLSearchParams","window","location","search","uid","get","parseInt","togglerNode","node","target","tagName","isHide","currentTarget","children","style","display","className","i","length","traverseNode","nodes","Array","isArray","console","error","map","type","e","stopPropagation","currentUid","alert","name","child","Math","random","x","y","height","width","resize","minWidth","minHeight","maxWidth"],"sources":["/Users/feng/Work/Project/df/df.im/df.im.client/src/im/imMain.js"],"sourcesContent":["import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n  togglerMain,\n  togglerSetting,\n  togglerChat,\n  togglerHelp,\n  clearUnreadMessages,\n} from \"./imStore\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faMinus,\n  faMagnifyingGlass,\n  faGear,\n  faCircleQuestion,\n  faBuildingUser,\n  faUser,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { ImDialog } from \"./imCore\";\n\nfunction ImMain() {\n  const dispatch = useDispatch();\n  const size = useSelector((state) => state.imReducer.size);\n  const users = useSelector((state) => state.imReducer.users);\n  const onlineUsers = useSelector((state) => state.imReducer.onlineUsers);\n  const unreadMessages = useSelector((state) => state.imReducer.unreadMessages);\n\n  let bounds = {\n    left: size.left,\n    top: size.top,\n    right: size.right - 170,\n    bottom: size.bottom - 50,\n  };\n\n  const getMeUid = () => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const uid = urlParams.get(\"uId\");\n    return parseInt(uid);\n  };\n\n  const togglerNode = (node) => {\n    if (node.target.tagName === \"UL\") return;\n    let isHide = node.currentTarget.children[1].style.display === \"none\";\n    node.currentTarget.className = isHide\n      ? \"open department im-node-text\"\n      : \"close department im-node-text\";\n\n    for (var i = 1; i < node.currentTarget.children.length; i++) {\n      node.currentTarget.children[i].style.display = isHide ? \"block\" : \"none\";\n    }\n  };\n\n  const traverseNode = (nodes) => {\n    if (!Array.isArray(nodes)) {\n      console.error(\"Expected nodes to be an array, got:\", nodes);\n      return [];\n    }\n    return nodes.map((node) => (\n      <li\n        key={node.uid + node.type + Math.random()}\n        className={\n          node.type === \"C\"\n            ? \"open department im-node-text\"\n            : onlineUsers[node.uid]\n            ? \"user user-online im-node-text\"\n            : \"user user-offline im-node-text\"\n        }\n        onClick={(e) => {\n          e.stopPropagation();\n          if (node.type === \"U\") {\n            const urlParams = new URLSearchParams(window.location.search);\n            const currentUid = parseInt(urlParams.get(\"uId\"));\n            if (node.uid === currentUid) {\n              alert(\"不能给自己发消息！\");\n              return;\n            }\n            dispatch(togglerChat({ name: node.name, uid: node.uid }));\n            dispatch(clearUnreadMessages({ uid: node.uid }));\n          } else {\n            togglerNode(e);\n          }\n        }}\n        onTouchEnd={(e) => {\n          if (node.type === \"U\") {\n            const urlParams = new URLSearchParams(window.location.search);\n            const currentUid = parseInt(urlParams.get(\"uId\"));\n            if (node.uid === currentUid) {\n              alert(\"不能给自己发消息！\");\n              return;\n            }\n            dispatch(togglerChat({ name: node.name, uid: node.uid }));\n            dispatch(clearUnreadMessages({ uid: node.uid }));\n          }\n        }}\n      >\n        {node.type === \"C\" ? (\n          <FontAwesomeIcon icon={faBuildingUser} className=\"avtar\" />\n        ) : (\n          <FontAwesomeIcon icon={faUser} className=\"avtar\" />\n        )}\n        {node.name}\n        {node.uid === getMeUid() ? \" [Me]\" : null}\n        {unreadMessages[node.uid] > 0 && (\n          <span className=\"unread-count\">{unreadMessages[node.uid]}</span>\n        )}\n\n        {node.child ? <ul>{traverseNode(node.child)}</ul> : null}\n      </li>\n    ));\n  };\n\n  return (\n    <ImDialog\n      point={{ x: bounds.left, y: bounds.top }}\n      bounds={bounds}\n      title={<span className=\"im-header-title\">IM</span>}\n      buttons={\n        <div>\n          <button\n            className=\"im-header-button\"\n            onClick={() => dispatch(togglerHelp())}\n            onTouchEnd={() => dispatch(togglerHelp())}\n          >\n            <FontAwesomeIcon icon={faCircleQuestion} />\n          </button>\n          <button\n            className=\"im-header-button\"\n            onClick={() => dispatch(togglerSetting())}\n            onTouchEnd={() => dispatch(togglerSetting())}\n          >\n            <FontAwesomeIcon icon={faGear} />\n          </button>\n          <button\n            className=\"im-header-button\"\n            onClick={() => dispatch(togglerMain())}\n            onTouchEnd={() => dispatch(togglerMain())}\n          >\n            <FontAwesomeIcon icon={faMinus} />\n          </button>\n        </div>\n      }\n      cancel={\".im-header-button, .im-search\"}\n      style={{\n        height: 500,\n        width: 205,\n        resize: \"both\",\n        minWidth: 205,\n        minHeight: 300,\n        maxWidth: 250,\n      }}\n    >\n      <div className=\"im-frame\">\n        <div className=\"im-search\">\n          <input\n            className=\"im-input\"\n            type=\"text\"\n            placeholder=\"请输入对方的昵称\"\n            required\n          />\n          <button className=\"im-header-button\">\n            <FontAwesomeIcon icon={faMagnifyingGlass} />\n          </button>\n        </div>\n        <div className=\"im-main-list\">\n          <ul className=\"domtree\">{traverseNode(users)}</ul>\n        </div>\n      </div>\n    </ImDialog>\n  );\n}\n\nexport default ImMain;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}